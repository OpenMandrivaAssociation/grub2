From ee2349ef655399970f2a4521e3e35f17d81ffe14 Mon Sep 17 00:00:00 2001
From: Glenn Washburn <development@efficientek.com>
Date: Mon, 14 Aug 2023 15:00:10 -0500
Subject: [PATCH 19/57] tests/util/grub-shell-luks-tester: Do not remove
 generated files when test fails to allow debugging

Signed-off-by: Glenn Washburn <development@efficientek.com>
Reviewed-by: Daniel Kiper <daniel.kiper@oracle.com>
---
 tests/util/grub-shell-luks-tester.in | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/tests/util/grub-shell-luks-tester.in b/tests/util/grub-shell-luks-tester.in
index 850a20d6a..3f9d1be17 100644
--- a/tests/util/grub-shell-luks-tester.in
+++ b/tests/util/grub-shell-luks-tester.in
@@ -145,7 +145,9 @@ cleanup() {
     if [ -e "$luksdev" ]; then
         cryptsetup close "$luksdev"
     fi
-    [ -z "$debug" ] && rm -rf "$lukstestdir" || :
+    if [ -z "$debug" ] && [ "${RET:-1}" -eq 0 ]; then
+        rm -rf "$lukstestdir" || :
+    fi
 }
 trap cleanup EXIT INT TERM KILL QUIT
 
-- 
2.42.0

